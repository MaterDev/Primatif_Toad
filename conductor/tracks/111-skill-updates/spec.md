# Specification: Skill Updates (111-skill-updates)

## Overview

Update the AI skills generated by `toad skill sync` to reflect v1.1.0 features, ensure accuracy, and improve their usefulness for AI agents. This includes the architectural blueprint and CLI reference skills.

## Sources

- **Current Implementation:** `crates/toad-manifest/src/lib.rs` (`generate_blueprint`, `generate_cli_skill`)
- **Skill Command:** `bin/toad/src/commands/skill.rs`
- **Pre-release Review:** Final v1.1.0 check findings

---

## Problem Statement

The generated skills may be outdated or incomplete:

1. **Blueprint Skill** — May not include DNA information or new architectural patterns
2. **CLI Reference** — Generated from `clap` help text, but may lack context about when to use commands
3. **Missing Skills** — No skill for MCP tools or common workflows

---

## Goals

1. **Enhance Blueprint Skill** — Include DNA patterns, capabilities, and architectural insights
2. **Improve CLI Reference** — Add usage guidance and common patterns
3. **Add MCP Skill** — Document MCP tools for AI agents using Toad via MCP
4. **Verify Accuracy** — Ensure all skills reflect v1.1.0 features

---

## Non-Goals

- Auto-updating skills (manual `toad skill sync` is fine)
- Skills for every possible workflow (focus on high-value patterns)

---

## Architecture Decisions

### AD-1: Three Core Skills

Toad generates three skills:

1. **`toad-blueprint.md`** — Architectural map with DNA patterns
2. **`toad-cli.md`** — Command reference with usage guidance
3. **`toad-mcp.md`** — MCP tools and workflows (NEW)

### AD-2: Token-Aware Generation

All skills respect token budgets from `GlobalConfig`:
- Blueprint: `ecosystem_tokens` limit
- CLI: No limit (relatively small)
- MCP: `ecosystem_tokens` limit

### AD-3: Distribution to AI Vendors

Skills are distributed to configured AI vendors:
- Windsurf → `.windsurf/rules/`
- Cursor → `.cursorrules`
- Gemini → `.gemini/skills/`
- etc.

---

## Implementation Plan

### Phase 1: Enhance Blueprint Skill (15 min)

**File:** `crates/toad-manifest/src/lib.rs`

Update `generate_blueprint` to include:

```rust
pub fn generate_blueprint(projects: &[ProjectDetail], token_limit: Option<usize>) -> String {
    let mut output = String::new();
    output.push_str("# Architectural Blueprint (Context)\n\n");
    output.push_str("> **Purpose:** Provides AI agents with a zero-latency vision of the project's dependency graph, DNA patterns, and logical flow.\n\n");
    
    // 1. Dependency Graph (existing)
    output.push_str("## Dependency Graph\n\n");
    // ... existing code ...
    
    // 2. DNA Patterns (NEW)
    output.push_str("\n## DNA Patterns\n\n");
    output.push_str("Projects grouped by structural patterns:\n\n");
    
    let mut by_role: HashMap<String, Vec<&ProjectDetail>> = HashMap::new();
    for p in projects {
        for role in &p.dna.roles {
            by_role.entry(role.clone()).or_default().push(p);
        }
    }
    
    for (role, projs) in by_role {
        output.push_str(&format!("### {}\n\n", role));
        for p in projs {
            output.push_str(&format!("- **{}** ({})\n", p.name, p.stack));
            if !p.dna.capabilities.is_empty() {
                output.push_str(&format!("  - Capabilities: {}\n", p.dna.capabilities.join(", ")));
            }
        }
        output.push('\n');
    }
    
    // 3. Stack Distribution (NEW)
    output.push_str("\n## Stack Distribution\n\n");
    let mut by_stack: HashMap<String, usize> = HashMap::new();
    for p in projects {
        *by_stack.entry(p.stack.clone()).or_default() += 1;
    }
    
    for (stack, count) in by_stack {
        output.push_str(&format!("- **{}**: {} projects\n", stack, count));
    }
    
    // Apply token limit
    if let Some(limit) = token_limit {
        output = truncate_by_tokens(&output, limit);
    }
    
    output
}
```

### Phase 2: Improve CLI Reference (10 min)

**File:** `crates/toad-manifest/src/lib.rs`

Update `generate_cli_skill` to add usage guidance:

```rust
pub fn generate_cli_skill(help_text: &str) -> String {
    let mut output = String::new();
    output.push_str("# Toad CLI Reference (Skill)\n\n");
    output.push_str("> **Purpose:** Comprehensive map of all available commands and their capabilities.\n\n");
    
    // 1. Command Reference (existing)
    output.push_str("## Command Reference\n\n");
    output.push_str("```text\n");
    output.push_str(help_text);
    output.push_str("\n```\n\n");
    
    // 2. Common Patterns (NEW)
    output.push_str("## Common Patterns\n\n");
    output.push_str("### Discovery & Search\n");
    output.push_str("- `toad reveal <query>` — Find projects by name\n");
    output.push_str("- `toad status` — Health check across ecosystem\n");
    output.push_str("- `toad stats` — Disk usage and bloat analytics\n\n");
    
    output.push_str("### Multi-Repo Git\n");
    output.push_str("- `toad ggit status` — Git status across all repos\n");
    output.push_str("- `toad ggit commit -m \"msg\" --cascade` — Commit + update hub\n");
    output.push_str("- `toad ggit sync` — Pull + align submodules\n\n");
    
    output.push_str("### Context Engineering\n");
    output.push_str("- `toad manifest` — Generate AI context files\n");
    output.push_str("- `toad skill sync` — Distribute to AI vendors\n");
    output.push_str("- `toad context --task \"<task>\"` — Task-specific briefing\n\n");
    
    output.push_str("### Bulk Operations\n");
    output.push_str("- `toad do \"<cmd>\" --query <filter>` — Execute across projects\n");
    output.push_str("- `toad clean --tier cold` — Reclaim disk space\n");
    output.push_str("- `toad tag --harvest` — Auto-assign taxonomy\n\n");
    
    output
}
```

### Phase 3: Add MCP Skill (15 min)

**File:** `crates/toad-manifest/src/lib.rs`

Add new function:

```rust
pub fn generate_mcp_skill() -> String {
    let mut output = String::new();
    output.push_str("# Toad MCP Tools (Skill)\n\n");
    output.push_str("> **Purpose:** Reference for AI agents using Toad via Model Context Protocol.\n\n");
    
    output.push_str("## Available Tools\n\n");
    
    output.push_str("### Discovery\n");
    output.push_str("- `list_projects` — Filter projects by query, tag, stack, activity, vcs_status\n");
    output.push_str("- `get_project_detail` — Full metadata for a single project\n");
    output.push_str("- `search_projects` — Semantic search across names, essence, tags\n");
    output.push_str("- `search_projects_by_dna` — Find projects by role, capability, or pattern\n\n");
    
    output.push_str("### Context\n");
    output.push_str("- `get_ecosystem_summary` — SYSTEM_PROMPT.md overview\n");
    output.push_str("- `get_manifest` — Full ecosystem manifest\n");
    output.push_str("- `get_atlas` — DNA map for all projects\n");
    output.push_str("- `get_project_context` — Deep dive for specific project\n\n");
    
    output.push_str("### Health & Analytics\n");
    output.push_str("- `get_ecosystem_status` — VCS and alignment health\n");
    output.push_str("- `get_project_stats` — Disk usage and bloat analytics\n\n");
    
    output.push_str("### DNA & Migration\n");
    output.push_str("- `get_project_dna` — Structural patterns for a project\n");
    output.push_str("- `compare_projects` — Migration compatibility analysis\n\n");
    
    output.push_str("### Context Management\n");
    output.push_str("- `get_active_context` — Current workspace context\n");
    output.push_str("- `list_contexts` — All registered contexts\n");
    output.push_str("- `switch_context` — Change active context\n\n");
    
    output.push_str("## Common Workflows\n\n");
    output.push_str("### Get Full Ecosystem Context\n");
    output.push_str("1. `get_ecosystem_summary` — High-level overview\n");
    output.push_str("2. `get_manifest` — Detailed project table\n");
    output.push_str("3. `get_atlas` — DNA patterns\n\n");
    
    output.push_str("### Analyze Specific Project\n");
    output.push_str("1. `get_project_detail` — Basic metadata\n");
    output.push_str("2. `get_project_context` — Deep dive\n");
    output.push_str("3. `get_project_dna` — Structural patterns\n\n");
    
    output.push_str("### Find Projects by Capability\n");
    output.push_str("1. `search_projects_by_dna` with query: \"async\"\n");
    output.push_str("2. Filter results by stack or activity\n");
    output.push_str("3. `get_project_context` for matches\n\n");
    
    output
}
```

### Phase 4: Update Skill Command (5 min)

**File:** `bin/toad/src/commands/skill.rs`

Update `SkillCommand::Sync` to generate MCP skill:

```rust
// 3. Generate MCP Skill
println!("Generating MCP Tools Reference...");
let mcp_skill = toad_manifest::generate_mcp_skill();

let skills = vec![
    ("toad-blueprint".to_string(), blueprint.clone()),
    ("toad-cli".to_string(), cli_skill.clone()),
    ("toad-mcp".to_string(), mcp_skill.clone()),  // NEW
];
```

---

## Success Criteria

- [ ] Blueprint skill includes DNA patterns and stack distribution
- [ ] CLI skill includes common patterns section
- [ ] MCP skill documents all 16 tools with workflows
- [ ] `toad skill sync` generates all three skills
- [ ] Skills are distributed to configured AI vendors
- [ ] All skills respect token budgets

---

## Integration Points

- **Depends on:** `toad-core::ProjectDetail`, `toad-core::GlobalConfig`
- **Consumed by:** AI agents via vendor-specific paths
- **Testing:** Run `toad skill sync` and verify output

---

## Future Enhancements

- Auto-detect new MCP tools from server implementation
- Generate skills for custom workflows
- Skill versioning and changelog
